<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="apple-touch-icon" sizes="57x57" href="https://www.joshuastevens.net/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://www.joshuastevens.net/apple-icon-60x60.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.joshuastevens.net/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://www.joshuastevens.net/favicon-16x16.png">
    <link rel="manifest" href="https://www.joshuastevens.net/manifest.json">
    <title>Tutorial: Turning on The Lights
    </title>
    <meta name="theme-color" content="#5c5888">
    <link href="https://www.joshuastevens.net/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://www.joshuastevens.net/css/style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans|Poppins:300" rel="stylesheet">
    <link rel="stylesheet" href="https://www.joshuastevens.net/css/font-awesome.min.css">
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/ocean.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@jscarto" />
    <meta name="twitter:title" content="Tutorial: Turning on The Lights" />

    <meta name="twitter:image" content="http://www.joshuastevens.net/images/earth_vir_th.jpg" />
    <meta name="twitter:description" content="VIIRS sheds light on Earth at night."/>
    <meta property="og:image" content="http://www.joshuastevens.net/images/earth_vir_th.jpg" />
    <meta name="description" content="VIIRS sheds light on Earth at night."/>
     <meta property="og:description" content="VIIRS sheds light on Earth at night."/>
  </head>

  <nav class="navbar navbar-expand-md sticky-top navbar-light bg-light">
      <div class="container">
        <a class="navbar-brand" href="https://www.joshuastevens.net/"><img src="https://www.joshuastevens.net/css/js_logo.png" /> Joshua Stevens</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item ">
              <a class="nav-link" href="https://www.joshuastevens.net/">Home</a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="https://www.joshuastevens.net/blog/">Blog</a>
            </li>
            <li class="nav-item ">
              <a class="nav-link" href="https://www.joshuastevens.net/about/">About</a>
            </li>
            <li class="nav-item ">
              <a class="nav-link" href="https://www.joshuastevens.net/portfolio/">Work</a>
            </li>
            <li class="nav-item ">
              <a class="nav-link" href="https://www.joshuastevens.net/contact/">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
	
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.10&appId=240209906031266";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<script>hljs.initHighlightingOnLoad();</script>
<div class="container">
	<div class="article">

	<h1 class="title">Tutorial: Turning on The Lights</h1>
	<h3 class="title">An Introduction to VIIRS Nighttime Imagery</h3>
	<div class="postDate">
		<i class="fa fa-calendar"></i> April 1, 2019
	</div>

	<p>The most familiar views of Earth from space feature a blue-green planet lit by the Sun.</p>

<p>But in the darkness of night when <a href="https://earthobservatory.nasa.gov/images/87468/elba-and-the-mediterranean-at-night">the Moon</a>, <a href="https://earthobservatory.nasa.gov/images/90008/night-light-maps-open-up-new-applications">city lights</a>, <a href="https://earthobservatory.nasa.gov/images/90578/fires-light-up-mount-vesuvius">fires</a>, or <a href="https://earthobservatory.nasa.gov/images/144754/dazzling-spring-aurora-over-hudson-bay">aurorae</a> illuminate Earth, some satellites continue to gather images of light. And they are fantastic!</p>

<p>So how does such imagery come to be? Let&rsquo;s take a look!</p>

<p><blockquote class="twitter-tweet" data-lang="en" align="center"><p lang="en" dir="ltr">On my bucket list: seeing the <a href="https://twitter.com/hashtag/NorthernLights?src=hash&amp;ref_src=twsrc%5Etfw">#NorthernLights</a>&#39; brilliant glow overhead.<br><br>Until then, Suomi VIIRS provides a spectacular view of auroras from above - like this one on March 28: <a href="https://t.co/0RDgyVF20u">https://t.co/0RDgyVF20u</a> <a href="https://twitter.com/hashtag/AuroraBorealis?src=hash&amp;ref_src=twsrc%5Etfw">#AuroraBorealis</a> <a href="https://t.co/eZD0VjhrOn">pic.twitter.com/eZD0VjhrOn</a></p>&mdash; Joshua Stevens (@jscarto) <a href="https://twitter.com/jscarto/status/1111698240418795520?ref_src=twsrc%5Etfw">March 29, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></p>

<p>Twice a day, the <a href="https://www.jpss.noaa.gov/mission_and_instruments.html">Suomi NPP and NOAA-20 satellites</a> capture a global view of Earth—once during day, once at night. Both satellites are equipped with a <a href="https://ncc.nesdis.noaa.gov/VIIRS/">Visible Infrared Imaging Radiometer Suite</a> (VIIRS) instrument. Among the capabilities of VIIRS is the &ldquo;day/night band,&rdquo; or DNB. The highly sensitive DNB collects measurements of light from below, with adjustments to ensure each pixel acquired is neither overly bright or too dark.</p>

<p>When it comes to DNB, VIIRS is poetically sensitive. So much so that the instrument is able to <a href="https://www.pnas.org/content/109/39/15706">detect startlight from our galaxy</a> as it scatters across Earth&rsquo;s atmosphere. (I am imagining here scenes described in <em>The Silmarillion</em>, as Tolkien&rsquo;s elves stare longingly skyward at the faint glow of many stars.)</p>

<p>VIIRS really is incredible. Let&rsquo;s take a look at the process of <strong>acquiring DNB data</strong> and <strong>producing imagery</strong>.</p>

<p>This tutorial requires <a href="https://www.gdal.org/">GDAL</a> and some basic familiarity with the command line.</p>

<h4 id="acquiring-data">Acquiring Data</h4>

<div class="alert alert-purp" role="alert">
  You will need a free <a href="https://earthdata.nasa.gov/" class="alert-link">NASA Earthdata</a> account to find and download the data used in this tutorial.

  To create one, visit: <a href="https://urs.earthdata.nasa.go" class="alert-link">https://urs.earthdata.nasa.gov</a>
</div>

<p>We&rsquo;ll be using the Level-1B DNB data from Suomi, known as &ldquo;NPP_VDNES_L1.&rdquo; The Suomi VIIRS DNB data have a spatial resolution of 750 m/px and are available from January 19, 2012—present.</p>

<ol>
<li><p>Go to the <a href="https://ladsweb.modaps.eosdis.nasa.gov/search/order/1/NPP_VDNES_L1--5000">LAADS DAAC</a> data portal.</p>

<p>The link above will automatically select the <strong>NPP_VDNES_L1</strong> product for you. Ensure to select it otherwise.</p>

<div class="fullImage">
    <img src="/images/dnb_tutorial_product.png" />
</div>

<p>With the correct data selected, we must now chose a time (or time period) in which to search for files.</p></li>

<li><p>Click <strong>Time</strong> at the top of the data portal, select <strong>Single Date</strong>, and then enter date of interest. For the coverage selection, uncheck <strong>Day</strong>, then check the boxes for <strong>Night</strong> and <strong>Day-Night Boundary</strong>.</p>

<p>I&rsquo;ve chosen March 26, 2019, which offered a clear view of the Great Lakes.</p>

<p>Click <strong>Add Date</strong>.</p>

<div class="fullImage">
    <img src="/images/dnb_tutorial_date.png" />
</div>

<p>The correct data is chosen. A time has been selected. Now we just need to subset the search by location.</p></li>

<li><p>Click <strong>Location</strong> at the top of the data portal. You will be presented with a map view.</p>

<p>From here, you can choose a location in a variety of ways. Since I want to see the Great Lakes, I&rsquo;ve zoomed and panned the map to the general area.</p>

<p>I then used the <strong>Draw Custom Box</strong> tool to draw a box that falls within the area I want to download.</p>

<div class="fullImage">
     <img src="/images/dnb_tutorial_map.jpg" />
</div>

<div class="alert alert-warning" role="alert">
<strong>Note:</strong> The search will find all data granules that intersect the drawn box. <em>It will not crop the data to the box!</em>
</div></li>

<li><p>Click <strong>Files</strong> at the top of the data portal. This will return a list of files that match your criteria.</p>

<div class="fullImage">
     <img src="/images/dnb_tutorial_files.png" />
</div>

<p>Since VIIRS Level-1 granules are quite wide, there is a good chance you will receive several results for a given location. One or more of these results will contain your location well within the granule, while others might barely overlap at the edge of the granule. VIIRS data is noisier at the edges, so you want the granule(s) that contain your location as close to the center as possible.</p>

<p>Knowing which file(s) to download takes a bit of investigation. The nighttime orbit of Suomi can be <a href="https://go.nasa.gov/2FEo06E">viewed in Worldview</a>, which shows the times (in UTC) and location of the satellite. Change the date and move the map around to see the oribital path specific to the time and place you&rsquo;re interested in.</p>

<div class="fullImage">
     <img src="/images/dnb_tutorial_worldview.gif" />
</div>

<p>The orbit of Suomi on March 26 shows that VIIRS got two views of the Great Lakes, once at about 6:50 and again around 8:40 UTC.</p>

<p>A more centered view comes from the orbit that happened around  6:50, so that&rsquo;s what I want to look for in the search results.</p>

<p>The first file in the results from the data portal was acquired at 2019-03-26 <strong>06:54:00</strong>. That&rsquo;s the one I want!</p></li>

<li><p>In the NASA Earthdata portal, click the download icon next to your file of choice to begin downloading the data. The data will be an <a href="https://en.wikipedia.org/wiki/Hierarchical_Data_Format">HDF file</a>.</p>

<p>With the data handy, it is time to process it into imagery.</p></li>
</ol>

<h4 id="producing-imagery">Producing Imagery</h4>

<p>Being an HDF (Hierarchical Data Format), the DNB data includes multiple variables, arranged in a well-defined structure.</p>

<p>GDAL makes it easy to look at this structure and find the variable(s) from which imagery can be produced.</p>

<p>For instance, if you had a file named MY_FILE, the command <code>gdalinfo MY_FILE</code> will output information about that file, including its data and subdatasets, dimensions, spatial projection, and other metadata.</p>

<p>Go ahead and try it on the DNB data file. You will see a lot of information.</p>

<p>We want to get the full path to the DNB data for mapping. The variable within this file that we&rsquo;ll be using is called <strong>Radiance</strong>. (The units are watts per square centimeter per steradian,  W cm<sup>-2</sup> sr<sup>-1</sup>.)</p>

<p>The full HDF path to the Radiance variable can be retried via:</p>

<pre><code class="language-sh">gdalinfo NPP_VDNES_L1.A2019085.0654.001.2019085123230.hdf | grep Radiance
</code></pre>

<p>In the output, one line includes <code>NAME=</code>, followed by the full path to the variable. For the file I&rsquo;ve downloaded, this is:</p>

<pre><code>HDF4_EOS:EOS_SWATH:&quot;NPP_VDNES_L1.A2019085.0654.001.2019085123230.hdf&quot;:VIIRS_EV_DNB_SDR:Radiance
</code></pre>

<p>Note that this is just the filename in quotations, with <code>HDF4_EOS:EOS_SWATH:</code> prepended to the front, and <code>:VIIRS_EV_DNB_SDR:Radiance</code> appended to the end. These tell GDAL which kind of file it is working with (HDF has many varieties), the name of the file, and where to find the data within the file.</p>

<h5 id="initial-geolocation-and-reprojection">Initial Geolocation and Reprojection</h5>

<p>The first thing to do is reproject the data and output the variable of interest to a simpler GeoTIFF.</p>

<p>Using the full path to the <strong>Radiance</strong> variable, we can now use <code>gdalwarp</code> to:</p>

<ol>
<li>Reproject the variable</li>
<li>Ensure the resolution remains 750 m/px</li>
<li>Define a resampling method used during the reprojection</li>
<li>Geolocate the variable from geolocation arrays within the data</li>
<li>Output a GeoTIFF</li>
</ol>

<p>This all happens in the command below, which reprojects the data from WGS84 to <a href="https://epsg.io/5070">EPSG:5070</a> (CONUS Albers Equal Area).</p>

<pre><code class="language-sh">gdalwarp -s_srs WGS84 -t_srs EPSG:5070\
    -tr 750 750\
    -r bilinear\
    -geoloc\
    'HDF4_EOS:EOS_SWATH:&quot;NPP_VDNES_L1.A2019085.0654.001.2019085123230.hdf&quot;:VIIRS_EV_DNB_SDR:Radiance'\
    greatlakes_vir_dnb.tif
</code></pre>

<div class="alert alert-warning" role="alert">
    <strong>Note:</strong> <strong>gdalwarp</strong> is used in place of the more obvious <strong>gdal_translate</strong>. This is because the <em>-geoloc</em> option is vital. Without it, the geolocation arrays would not be properly read, and the tiff would not be correctly georeferenced.
</div>

<p>The resulting GeoTIFF (<code>greatlakes_vir_dnb.tif</code>) would work well in almost any GIS software, though it will need to be &ldquo;stretched&rdquo; between some minimum and maximum value. But if you tried to open it in Photoshop or other image programs, it will probably look like a whole lot of nothing.</p>

<p>This is because the units for DNB Radiance are incredibly small, and the data are 32-bit floating point numbers. Most photo software is not designed for this precision.</p>

<p>We can solve that by converting the data to 16-bit integers, scaled to a smaller range of values.</p>

<h5 id="scaling-the-data">Scaling the data</h5>

<p>Rather than asking photo software or web browsers to display the full 32-bit range, which would result in an almost entirely black image, we can scale a small portion of the radiance&ndash;where visible data actually exists&ndash;across the smaller integer range. This &ldquo;stretching&rdquo; will make the data immediately visible.</p>

<div class="fullImage">
    <img src="/images/dnb_tutorial_data_range.png" />
</div>

<p>Stretching can be accomplished with <code>gdal_translate</code>. To produce a visible image, a few things should be done:</p>

<ol>
<li>Convert the data to 16-bit unsigned integers</li>
<li>Data values [0 - 0.000000008] stretched to [0 - 65536]</li>
<li>Resize the image to 800px wide (for display online) using bilinear resampling</li>
</ol>

<p>The command below does that:</p>

<pre><code class="language-sh">gdal_translate -ot UInt16 -scale 0 8e-9 0 65536\
    -outsize 800 0 -r bilinear\
    greatlakes_vir_dnb.tif greatlakes_vir_dnb_int.tif
</code></pre>

<p>Excellent! We now have a visible image of the data.</p>

<div class="fullImage">
    <img src="/images/dnb_tutorial_image.jpg" />
    <p>
City lights around the Great Lakes shine brightly under the relatively clear skies of March 26, 2019. The GeoTIFF was saved as a JPEG for smaller size on the web.</p>
</div>

<p>There is nothing special about the value 0.000000008 (8e-9). It is just a temporary starting point to produce a visible image.</p>

<p>In the image above, city lights, some of the landscape, and clouds over the Atlantic are easily visible. The brightest parts of the cities are a bit too bright—our stretch needs some fine tuning. Each image will have its own assortment of values, and features within the image, that require some tweaking.</p>

<p>One might even apply a logarithmic or square root stretch, which can help emphasize dimmer lights without overblowing clouds or super bright areas. I used a square root stretch when creating the <a href="https://earthobservatory.nasa.gov/images/90008/night-light-maps-open-up-new-applications">2016 and 2012 Black Marble imagery</a>.</p>

<p>Some outlets <a href="https://go.nasa.gov/2uACmA1">automate this processing with a consistent stretch</a>. This works well for getting an overall sense of the data, but is not optimal. An image of city lights will need to be stretched differently from one that emphasizes an aurora, for instance.</p>

<p>But you are now equipped to start making these decisions to process the data in a way that fits your needs and end results!</p>

<h4 id="notes-and-caveats">Notes and Caveats</h4>

<p>Nightlights imagery has been particularly desirable for newsrooms. With countries experiencing power outages, due to manmade or natural causes, showing a before-and-after comparison is appealing.</p>

<p>Pump the brakes! Recall that VIIRS DNB is mind-blowingly sensitive. The overall brightness or dimness of an area is not without influence from moonlight (and the phase of the moon), the albedo of the landscape—including snow or other seasonal variations, airglow, and even distant stars! It is easy to be misled. A thin veil of clouds can make dim city lights appear larger and brighter, as the light is spread around more diffusely. All of this needs to be accounted for to ensure the changes you see are actually changes in the lighting conditions of interest, and not changes in the environmental conditions.</p>

<p>Techniques that normalize the data for these factors exist. Most commonly this is through a Bidirectional Reflectance Distribution Function (BRDF). For VIIRS DNB data, this is not straightforward and requires the collection of daytime DNB imagery to determine parameters used in the analysis, among other considerations.</p>

<p>NASA scientists are producing <a href="https://www.sciencedirect.com/science/article/pii/S003442571830110X">a version of VIIRS DNB data with atmospheric and BRDF corrections</a>. For analytical purposes, this type of data should be preferred. In any case, it is best to speak to a scientist before drawing conclusions from changes observed in DNB imagery.</p>

<p>This is primarily a concern for comparative analysis. For viewing features at a single point in time (auroras, wildfires, sea ice, and so on), the processing shown here will get you off to a great start.</p>

<p>So turn on the lights and start making some nighttime images! If you do produce some imagery I would love to see it.</p>

<h4 id="links-and-further-reading">Links and Further Reading</h4>

<ul>
<li><p><a href="https://earthobservatory.nasa.gov/features/NightLights">Earth at Night</a> imagery from NASA Earth Observatory</p></li>

<li><p>Nightly preview of VIIRS DNB data in <a href="https://go.nasa.gov/2uACmA1">NASA Worldview</a></p></li>

<li><p>Curtis Seaman, CIRA/Colorado State University. <em>Beginner’s Guide to VIIRS Imagery Data</em> [<a href="http://rammb.cira.colostate.edu/projects/npp/Beginner_Guide_to_VIIRS_Imagery_Data.pdf">PDF</a>]</p></li>

<li><p>Román, Miguel O., et al. (2018). <a href="https://www.sciencedirect.com/science/article/pii/S003442571830110X">NASA&rsquo;s Black Marble Nighttime Lights Product Suite</a>. <em>Remote Sensing of Environment</em>, 210, 113-143.</p></li>

<li><p>Straka, W. et al. (2015). <em>Using VIIRS DNB to Detect Natural (and other) Disasters</em> [<a href="https://www.star.nesdis.noaa.gov/star/documents/meetings/2015JPSSAnnual/dayThree/03_Session7a_Straka_DNB_Disasters.pdf">PDF</a>]</p></li>
</ul>

	<hr>

	<div class="social">
		<span class="text-muted">Share This</span>
		<br>
		<div class="social-btn">
			<a href="https://twitter.com/share" class="twitter-share-button" data-size="large" data-via="jscarto" data-show-count="false">Tweet</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
		</div>

		<div class="fb-share-button social-btn" data-href="https://www.joshuastevens.net/blog/turning-on-the-lights/" data-layout="button" data-size="large" data-mobile-iframe="true">
			<a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.joshuastevens.net%2fblog%2fturning-on-the-lights%2f&amp;src=sdkpreparse">Share</a>
		</div>
	</div>

	<br>

	<div class="d-flex justify-content-between pagination text-small">
		<a href="https://www.joshuastevens.net/blog/topographic-diversity-of-the-contiguous-usa/"><i class="fa fa-arrow-left"></i> Topographic Diversity of the Contiguous USA</a>
		
		
		<a href="https://www.joshuastevens.net/blog/pinewood-nerdy-statistics/">Pinewood Nerdy <i class="fa fa-arrow-right"></i></a>
		</div>

	<div id="disqus_thread"></div>
	<script type="text/javascript">
	    var disqus_shortname = 'joshuastevens';
	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	</div>
</div>


<footer class="footer">
      <div class="container">
        <div class="row">
        <div class="col-sm-12 col-md-5 footer-left">
          <ul>
            <li><a  href="https://www.joshuastevens.net/">Home</a></li>
            <li><a class="active" href="https://www.joshuastevens.net/blog/">Blog</a></li>
            <li><a  href="https://www.joshuastevens.net/about/">About</a></li>
            <li><a  href="https://www.joshuastevens.net/portfolio/">Work</a></li>
            <li><a  href="https://www.joshuastevens.net/contact/">Contact</a></li>
          </ul>
          </div>
          <div class="col-sm-12 col-md-2 footer-mid"><a href="https://twitter.com/jscarto"><i class="fa fa-twitter fa-2x"></i></a> &nbsp; <a href="https://www.linkedin.com/in/jscarto/"><i class="fa fa-linkedin fa-2x"></i></a></div>
          <div class="col-sm-12 col-md-5 footer-right">© 2020 Joshua Stevens</div>
        </div>
      </div>
    </footer>
     <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://www.joshuastevens.net/js/bootstrap.min.js"></script>
    <script src="https://www.joshuastevens.net/js/ie10-viewport-bug-workaround.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
        ga('create', 'UA-39165504-1', 'joshuastevens.net');
        ga('send', 'pageview');
    </script>
  </body>
</html>